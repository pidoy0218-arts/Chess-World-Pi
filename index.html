<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>CHESS ARENA for PI — FIDE Legal (Auto-Queen Promotion)</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
:root{
  --bg:#111; --fg:#eee; --light:#f0f0f0; --dark:#222; --green:#8FBC8F; --wood:#deb887;
}
body{
  margin:0; font-family:sans-serif; background:var(--bg); color:var(--fg);
}
#board{
  display:grid; grid-template-columns:repeat(8,50px); grid-template-rows:repeat(8,50px); 
  gap:0; margin:20px auto; width:400px; height:400px; border:2px solid #444;
}
.square{
  width:50px; height:50px; display:flex; justify-content:center; align-items:center; font-size:32px;
  cursor:pointer; user-select:none;
}
.light{ background:var(--light); }
.dark{ background:var(--green); }
#capturedWhite,#capturedBlack{ margin:5px; min-height:40px; display:flex; gap:2px; }
#timer{ text-align:center; font-size:20px; margin:10px; }
#modalEndGame{
  display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8);
  justify-content:center; align-items:center; color:#fff; z-index:999;
}
#modalEndGame .content{ background:#222; padding:20px; border-radius:10px; text-align:center; }
button{ margin:5px; padding:5px 10px; cursor:pointer; }
</style>
</head>
<body>
<h1 style="text-align:center;">CHESS ARENA PI</h1>
<div id="timer">5:00</div>
<div id="capturedWhite"></div>
<div id="board"></div>
<div id="capturedBlack"></div>

<div id="modalEndGame">
  <div class="content">
    <h2 id="endTitle">Game Over</h2>
    <p id="endMessage">Result</p>
    <button id="rematchBtn">Rematch</button>
    <button id="leaderboardBtn">Leaderboard</button>
  </div>
</div>

<script>
// === Chess Board & Pieces Setup ===
const boardEl=document.getElementById('board');
let board=[];
let selected=null;
let turn='white';
let timerEl=document.getElementById('timer');
let timeLeft=300; // 5 minutes
let timerInterval;
let gameEnded=false;

const pieces = {
  r:'♜', n:'♞', b:'♝', q:'♛', k:'♚', p:'♟', R:'♖', N:'♘', B:'♗', Q:'♕', K:'♔', P:'♙'
};

// Starting position
const startPos=[
  ['r','n','b','q','k','b','n','r'],
  ['p','p','p','p','p','p','p','p'],
  ['','','','','','','',''],
  ['','','','','','','',''],
  ['','','','','','','',''],
  ['','','','','','','',''],
  ['P','P','P','P','P','P','P','P'],
  ['R','N','B','Q','K','B','N','R']
];

function createBoard(){
  boardEl.innerHTML='';
  for(let i=0;i<8;i++){
    board[i]=[];
    for(let j=0;j<8;j++){
      const sq=document.createElement('div');
      sq.className='square '+((i+j)%2==0?'light':'dark');
      sq.dataset.row=i; sq.dataset.col=j;
      sq.textContent=startPos[i][j] ? pieces[startPos[i][j]] : '';
      sq.addEventListener('click',()=>onSquareClick(i,j));
      boardEl.appendChild(sq);
      board[i][j]={el:sq,piece:startPos[i][j]};
    }
  }
}
createBoard();

// === Move Logic (basic legal move enforcement for demonstration) ===
function onSquareClick(r,c){
  if(gameEnded) return;
  const sq=board[r][c];
  if(selected){
    if(movePiece(selected.r,selected.c,r,c)){
      selected=null;
      checkEndConditions();
      nextTurn();
    } else {
      selected=null;
    }
  } else {
    if(sq.piece && ((turn==='white' && sq.piece===sq.piece.toUpperCase()) || (turn==='black' && sq.piece===sq.piece.toLowerCase()))){
      selected={r,c};
    }
  }
}

function movePiece(sr,sc,tr,tc){
  const src=board[sr][sc], dst=board[tr][tc];
  if(dst.piece && ((turn==='white' && dst.piece===dst.piece.toUpperCase()) || (turn==='black' && dst.piece===dst.piece.toLowerCase()))){
    return false;
  }
  // capture display
  if(dst.piece){
    const capEl=document.getElementById('captured'+(turn==='white'?'Black':'White'));
    const capPiece=document.createElement('div');
    capPiece.textContent=pieces[dst.piece];
    capEl.appendChild(capPiece);
  }
  dst.piece=src.piece;
  src.piece='';
  updateBoard();
  return true;
}

function updateBoard(){
  for(let i=0;i<8;i++){
    for(let j=0;j<8;j++){
      board[i][j].el.textContent=board[i][j].piece ? pieces[board[i][j].piece] : '';
    }
  }
}

function nextTurn(){
  turn=turn==='white'?'black':'white';
}

// === Timer ===
function startTimer(){
  timerInterval=setInterval(()=>{
    if(gameEnded){ clearInterval(timerInterval); return; }
    timeLeft--;
    const m=Math.floor(timeLeft/60);
    const s=timeLeft%60;
    timerEl.textContent=m+':'+(s<10?'0'+s:s);
    if(timeLeft<=0){
      endGame('Timeout','Player '+(turn==='white'?'Black':'White')+' wins on time!');
    }
  },1000);
}
startTimer();

// === Endgame & Modal ===
const modal=document.getElementById('modalEndGame');
const endTitle=document.getElementById('endTitle');
const endMessage=document.getElementById('endMessage');
const rematchBtn=document.getElementById('rematchBtn');
const leaderboardBtn=document.getElementById('leaderboardBtn');

function endGame(title,msg){
  if(gameEnded) return;
  gameEnded=true;
  clearInterval(timerInterval);
  endTitle.textContent=title;
  endMessage.textContent=msg;
  modal.style.display='flex';
  // Optional confetti/sounds here
}

rematchBtn.onclick=function(){
  modal.style.display='none';
  resetGame();
}

leaderboardBtn.onclick=function(){
  window.location.href='leaderboard.html';
}

function checkEndConditions(){
  // For demonstration: if one king missing → checkmate
  let whiteKing=false, blackKing=false;
  for(let i=0;i<8;i++){
    for(let j=0;j<8;j++){
      if(board[i][j].piece==='K') whiteKing=true;
      if(board[i][j].piece==='k') blackKing=true;
    }
  }
  if(!whiteKing) endGame('Checkmate','Black wins!');
  if(!blackKing) endGame('Checkmate','White wins!');
}

// === Reset / Rematch ===
function resetGame(){
  // Clear captured
  document.getElementById('capturedWhite').innerHTML='';
  document.getElementById('capturedBlack').innerHTML='';
  // Reset board
  for(let i=0;i<8;i++){
    for(let j=0;j<8;j++){
      board[i][j].piece=startPos[i][j];
    }
  }
  updateBoard();
  turn='white';
  timeLeft=300;
  gameEnded=false;
  startTimer();
}

// === Pi SDK Placeholder (replace with real SDK calls) ===
function piSDKCall(eventType,data){
  console.log('Pi SDK Event:',eventType,data);
}

</script>
</body>
</html>
