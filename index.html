<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chess Arena Pi — Classic Game</title>
<style>
  :root {
    --light-square: #d9f0c1; /* light green */
    --dark-square: #ffffff;   /* white */
    --white-piece: #c1b280;   /* solid khaki */
    --black-piece: #000000;   /* solid black */
    --highlight: #ffcc00;
  }
  body {
    background: #111;
    color: #eee;
    font-family: sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 0;
    padding: 0;
  }
  h1 { margin: 10px; text-align: center; }
  #board {
    display: grid;
    grid-template: repeat(8, 50px) / repeat(8, 50px);
    gap: 0;
    margin: 20px 0;
  }
  .square {
    width: 50px;
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 36px;
    cursor: pointer;
    user-select: none;
  }
  .light { background: var(--light-square); }
  .dark { background: var(--dark-square); }
  .highlight { background: var(--highlight) !important; }
  #timers { display: flex; gap: 40px; font-size: 18px; margin-bottom: 10px; }
  #captured { display: flex; justify-content: space-between; width: 500px; margin-bottom: 10px; }
  #captured div { display: flex; gap: 5px; }
  #controls { margin-top: 10px; display: flex; gap: 15px; }
  button { padding: 5px 10px; cursor: pointer; font-size: 16px; }
</style>
</head>
<body>
<h1>Chess Arena Pi — Classic Game</h1>
<div id="playerInfo">Player: <span id="playerId">P1</span></div>
<div id="timers">
  <div>White: <span id="whiteTimer">10:00</span></div>
  <div>Black: <span id="blackTimer">10:00</span></div>
</div>
<div id="captured">
  <div id="whiteCaptured"></div>
  <div id="blackCaptured"></div>
</div>
<div id="board"></div>
<div id="controls">
  <button id="resignBtn">Resign</button>
  <button id="drawBtn">Offer Draw</button>
  <button id="rematchBtn">Rematch</button>
</div>

<audio id="moveSound" src="move.mp3"></audio>
<audio id="winSound" src="win.mp3"></audio>
<audio id="loseSound" src="lose.mp3"></audio>
<audio id="tickSound" src="tick.mp3"></audio>

<script>
const boardEl = document.getElementById('board');
const whiteTimerEl = document.getElementById('whiteTimer');
const blackTimerEl = document.getElementById('blackTimer');
const whiteCapturedEl = document.getElementById('whiteCaptured');
const blackCapturedEl = document.getElementById('blackCaptured');
const playerIdEl = document.getElementById('playerId');
const moveSound = document.getElementById('moveSound');
const winSound = document.getElementById('winSound');
const loseSound = document.getElementById('loseSound');
const tickSound = document.getElementById('tickSound');

let board = [];
let selected = null;
let turn = 'white';
let capturedPieces = {white: [], black: []};
let timers = {white: 600, black: 600}; // 10min each
let timerInterval = null;

// Solid Unicode pieces
const PIECES = {
  'wp':'♙', 'wr':'♖','wn':'♘','wb':'♗','wq':'♕','wk':'♔',
  'bp':'♟','br':'♜','bn':'♞','bb':'♝','bq':'♛','bk':'♚'
};

// Initial board setup
const startPosition = [
  ['br','bn','bb','bq','bk','bb','bn','br'],
  ['bp','bp','bp','bp','bp','bp','bp','bp'],
  ['','','','','','','',''],
  ['','','','','','','',''],
  ['','','','','','','',''],
  ['','','','','','','',''],
  ['wp','wp','wp','wp','wp','wp','wp','wp'],
  ['wr','wn','wb','wq','wk','wb','wn','wr']
];

function initBoard() {
  board = JSON.parse(JSON.stringify(startPosition));
  boardEl.innerHTML = '';
  for(let i=0;i<8;i++){
    for(let j=0;j<8;j++){
      const sq = document.createElement('div');
      sq.className = 'square ' + ((i+j)%2==0?'light':'dark');
      sq.dataset.row = i;
      sq.dataset.col = j;
      sq.textContent = PIECES[board[i][j]] || '';
      sq.style.color = (board[i][j] && board[i][j][0]==='w') ? 'var(--white-piece)' : 'var(--black-piece)';
      sq.addEventListener('click', () => selectSquare(i,j));
      boardEl.appendChild(sq);
    }
  }
}

function updateBoard() {
  for(let i=0;i<8;i++){
    for(let j=0;j<8;j++){
      const sq = boardEl.children[i*8+j];
      sq.textContent = PIECES[board[i][j]] || '';
      sq.style.color = (board[i][j] && board[i][j][0]==='w') ? 'var(--white-piece)' : 'var(--black-piece)';
      sq.classList.remove('highlight');
    }
  }
}

function selectSquare(r,c) {
  if(selected){
    if(attemptMove(selected,r,c)){
      selected = null;
      updateBoard();
      switchTurn();
    } else {
      selected = null;
      updateBoard();
    }
  } else {
    if(board[r][c] && board[r][c][0] === turn[0]){
      selected = [r,c];
      boardEl.children[r*8+c].classList.add('highlight');
    }
  }
}

function attemptMove(from,toR,toC){
  const [r,c] = from;
  const piece = board[r][c];
  if(!piece) return false;
  if(!isLegalMove(r,c,toR,toC,piece)) return false;

  // capture
  if(board[toR][toC]){
    const cap = board[toR][toC];
    if(cap[0]==='w') capturedPieces.white.push(cap);
    else capturedPieces.black.push(cap);
    updateCaptured();
  }

  // Move piece
  board[toR][toC] = piece;
  board[r][c] = '';

  moveSound.play();
  return true;
}

// Placeholder FIDE logic
function isLegalMove(r,c,toR,toC,piece){ 
  // Prevent moving on same color
  const target = board[toR][toC];
  if(target && target[0] === piece[0]) return false;
  return true;
}

function updateCaptured(){
  whiteCapturedEl.textContent = capturedPieces.white.map(p=>PIECES[p]).join(' ');
  blackCapturedEl.textContent = capturedPieces.black.map(p=>PIECES[p]).join(' ');
}

function switchTurn(){
  turn = (turn==='white')?'black':'white';
  resetTimerInterval();
}

function resetTimerInterval(){
  if(timerInterval) clearInterval(timerInterval);
  timerInterval = setInterval(()=>{
    timers[turn]--;
    updateTimers();
    if(timers[turn]<=10) tickSound.play();
    if(timers[turn]<=0){
      clearInterval(timerInterval);
      alert(turn+' loses on time!');
      loseSound.play();
      winSound.play();
    }
  },1000);
}

function updateTimers(){
  whiteTimerEl.textContent = formatTime(timers.white);
  blackTimerEl.textContent = formatTime(timers.black);
}

function formatTime(t){
  const m = Math.floor(t/60);
  const s = t%60;
  return `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
}

// Buttons
document.getElementById('resignBtn').onclick = () => {
  if(confirm('Are you sure to resign?')){
    alert(turn+' resigns!'); 
    loseSound.play(); 
    winSound.play();
  }
};
document.getElementById('drawBtn').onclick = () => {
  if(confirm('Offer draw? 5s to respond')){
    alert('Draw agreed');
  } else {
    setTimeout(()=>alert('Draw declined'),5000);
  }
};
document.getElementById('rematchBtn').onclick = () => {
  if(confirm('Rematch?')){
    timers = {white:600, black:600};
    capturedPieces = {white:[], black:[]};
    turn = 'white';
    initBoard();
    updateTimers();
  } else {
    setTimeout(()=>alert('Rematch cancelled'),5000);
  }
};

// Initialize
initBoard();
updateTimers();
resetTimerInterval();
</script>
</body>
</html>
