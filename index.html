<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chess Arena Pi – Classic 10-min</title>
<style>
:root{
  --bg:#111; --fg:#eee; --light:#f0f0f0; --dark:#b1e59f; --sel:#ffcc00;
  --hint:#5ac8fa; --accent:#f4b400; --warn:#ff5252
}
body{margin:0;padding:16px;background:var(--bg);color:var(--fg);font-family:system-ui,Arial;display:flex;flex-direction:column;align-items:center;}
h1{margin:6px 0 2px;font-size:22px;text-align:center;}
.wrap{display:flex;gap:18px;flex-wrap:wrap;align-items:flex-start;justify-content:center;width:100%;max-width:1100px;}
#board{display:grid;grid-template-columns:repeat(8,min(10vw,66px));grid-template-rows:repeat(8,min(10vw,66px));border:6px solid #333;border-radius:10px;overflow:hidden;box-shadow:0 8px 24px rgba(0,0,0,.45);}
.sq{display:flex;align-items:center;justify-content:center;font-size:min(8vw,50px);cursor:pointer;}
.sq.light{background:var(--light);}
.sq.dark{background:var(--dark);}
.piece.white{color:#eee;font-weight:900;}
.piece.black{color:#000;font-weight:900;}
.sq.sel{outline:3px solid var(--sel);outline-offset:-3px;}
.sq.hint::after{content:"";width:22%;height:22%;border-radius:50%;background:var(--hint);opacity:.85;display:block;}
.sq.cap{box-shadow: inset 0 0 0 4px var(--warn);}
.side{min-width:260px;max-width:360px;display:flex;flex-direction:column;gap:10px;}
.panel{background:#1b1b1b;border:1px solid #2b2b2b;border-radius:10px;padding:10px 12px;}
.row{display:flex;justify-content:space-between;align-items:center;gap:10px;}
.timer{font-weight:700;font-size:18px;text-align:center;margin-bottom:4px;}
.moves{font-family:ui-monospace,Menlo,Consolas,monospace;font-size:13px;line-height:1.45;max-height:260px;overflow:auto;}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;align-items:center;justify-content:center;z-index:10;}
.modal.show{display:flex;}
.card{background:#1e1e1e;border:1px solid #2d2d2d;padding:16px;border-radius:12px;min-width:260px;}
.grid4{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-top:10px;}
.pick{font-size:34px;padding:10px;border-radius:10px;border:1px solid #333;background:#121212;color:#fff;cursor:pointer;}
#fx{position:fixed;inset:0;pointer-events:none;z-index:9;}
select{padding:6px;border-radius:6px;background:#222;color:#fff;border:1px solid #555;}
.playerRow{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;}
.playerRow div{flex:1;text-align:center;font-weight:700;}
</style>
</head>
<body>
<h1>♞ Chess Arena Pi – Classic 10-min</h1>

<div class="wrap">
  <div id="board" aria-label="chessboard"></div>

  <div class="side">
    <div class="panel">
      <div class="playerRow">
        <div id="p1">P1 (mock)</div>
        <div id="p2">P2 (mock)</div>
      </div>
      <div class="playerRow">
        <div class="timer" id="timer1">10:00</div>
        <div class="timer" id="timer2">10:00</div>
      </div>
      <div id="status" style="font-weight:700;text-align:center">White to move</div>
    </div>

    <div class="panel">
      <div class="row"><div><b>Move List</b></div></div>
      <div id="moves" class="moves"></div>
    </div>

    <div class="panel">
      <div class="row">
        <div><b>Leaderboard / Personal Best</b></div>
        <select id="leaderboard">
          <option value="">--Select Player--</option>
        </select>
      </div>
    </div>
  </div>
</div>

<div id="promo" class="modal" role="dialog" aria-modal="true">
  <div class="card">
    <div style="font-weight:700;margin-bottom:6px">Promote pawn to:</div>
    <div class="grid4">
      <button class="pick" data-piece="q">♛</button>
      <button class="pick" data-piece="r">♜</button>
      <button class="pick" data-piece="b">♝</button>
      <button class="pick" data-piece="n">♞</button>
    </div>
  </div>
</div>

<canvas id="fx"></canvas>

<script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/1.0.0/chess.min.js"></script>
<script>
const boardEl = document.getElementById('board');
const movesEl = document.getElementById('moves');
const statusEl = document.getElementById('status');
const promoModal = document.getElementById('promo');
const pickBtns = promoModal.querySelectorAll('.pick');

const game = new Chess(); // chess.js handles rules, legal moves, castling, en passant, check/checkmate

let selected = null;
let sideToMove = 'w';

function renderBoard(){
  boardEl.innerHTML = '';
  for(let r=0;r<8;r++){
    for(let c=0;c<8;c++){
      const sq = document.createElement('div');
      sq.className = 'sq ' + ((r+c)%2?'dark':'light');
      const piece = game.board()[r][c];
      if(piece){
        const el = document.createElement('div');
        el.className = 'piece ' + (piece.color==='w'?'white':'black');
        el.textContent = piece.type==='p'?'♟':piece.type==='r'?'♜':piece.type==='n'?'♞':piece.type==='b'?'♝':piece.type==='q'?'♛':'♚';
        sq.appendChild(el);
      }
      sq.dataset.r = r;
      sq.dataset.c = c;
      sq.addEventListener('click',()=>onSquareClick(r,c));
      boardEl.appendChild(sq);
    }
  }
}

function onSquareClick(r,c){
  const moveStr = UtoAlg(r,c);
  if(selected){
    let move = game.move({from:selected,to:moveStr,promotion:'q'});
    if(move){
      selected = null;
      renderBoard();
      updateStatus();
    }else{
      selected = null;
    }
  }else{
    const piece = game.get(UtoAlg(r,c));
    if(piece && piece.color===sideToMove) selected = UtoAlg(r,c);
  }
}

function updateStatus(){
  const s = game.turn() === 'w' ? 'White' : 'Black';
  sideToMove = game.turn();
  statusEl.textContent = s + ' to move';
  movesEl.textContent = game.history().join(', ');
  if(game.in_checkmate()){
    statusEl.textContent = s + ' lost by checkmate!';
    Confetti.burst();
  }else if(game.in_stalemate()){
    statusEl.textContent = 'Stalemate!';
  }
}

function UtoAlg(r,c){
  return 'abcdefgh'[c] + (8-r);
}

function startTimers(){
  let t1 = 600, t2 = 600;
  const tEl1 = document.getElementById('timer1');
  const tEl2 = document.getElementById('timer2');
  setInterval(()=>{
    if(game.turn()==='w' && t1>0){ t1--; tEl1.textContent = formatTime(t1); }
    else if(game.turn()==='b' && t2>0){ t2--; tEl2.textContent = formatTime(t2); }
  },1000);
}

function formatTime(s){
  const m = Math.floor(s/60), sec = s%60;
  return `${m.toString().padStart(2,'0')}:${sec.toString().padStart(2,'0')}`;
}

renderBoard();
updateStatus();
startTimers();

// Promotion modal
pickBtns.forEach(btn=>{
  btn.addEventListener('click',()=>{
    game.move({from:selected,to:selected,promotion:btn.dataset.piece});
    promoModal.classList.remove('show');
    renderBoard();
  });
});
</script>
</body>
</html>
