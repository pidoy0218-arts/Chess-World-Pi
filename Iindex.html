<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>CHESS ARENA PI — Classic Game</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
  :root{
    --bg:#f0e6d2; /* light wood background */
    --light:#f9f9f9; /* white squares */
    --dark:#769656; /* green/brown squares */
    --white-piece:#e3e3e3;
    --black-piece:#222;
    --sel:#ffcc00;
  }
  body{ margin:0;font-family:sans-serif;background:var(--bg);display:flex;flex-direction:column;align-items:center; }
  h2{ margin:5px; }
  #player-info{ display:flex; justify-content:space-between; width:100%; max-width:480px; margin:5px;}
  #board{ display:grid; grid-template: repeat(8, 1fr) / repeat(8, 1fr); width:320px; height:320px; border:2px solid #333; }
  .square{ width:40px;height:40px; display:flex; justify-content:center; align-items:center; font-size:32px; cursor:pointer; user-select:none; }
  .white{ background:var(--light); }
  .black{ background:var(--dark); color:white; }
  .highlight{ background:var(--sel) !important; }
  #captured{ display:flex; justify-content:space-between; width:320px; margin:5px; }
  #captured div{ display:flex; gap:3px; }
  button{ margin:3px; padding:5px 10px; font-size:14px; cursor:pointer; }
  #popup{ position:fixed; top:0; left:0;width:100%;height:100%; background:rgba(0,0,0,0.6); display:none; justify-content:center; align-items:center; z-index:10; }
  #popup-content{ background:#fff; padding:20px; border-radius:8px; text-align:center; max-width:250px;}
  #popup-content button{ margin:5px; }
  #timer{ font-size:18px; margin:5px;}
</style>
</head>
<body>

<h2>Classic Game — Chess Arena PI</h2>
<div id="player-info">
  <div id="player1">Player 1: <span id="id1">ID_123</span></div>
  <div id="timer">10:00</div>
  <div id="player2">Player 2: <span id="id2">ID_456</span></div>
</div>

<div id="board"></div>

<div id="captured">
  <div id="capturedWhite"></div>
  <div id="capturedBlack"></div>
</div>

<div>
  <button id="resignBtn">Resign</button>
  <button id="drawBtn">Offer Draw</button>
  <button id="rematchBtn">Rematch</button>
</div>

<div id="popup">
  <div id="popup-content">
    <p id="popup-text">Player offers draw</p>
    <button id="acceptBtn">Accept</button>
    <button id="declineBtn">Decline</button>
  </div>
</div>

<!-- Sounds -->
<audio id="moveSound" src="move.mp3"></audio>
<audio id="tickSound" src="tick.mp3"></audio>
<audio id="winSound" src="win.mp3"></audio>
<audio id="loseSound" src="lose.mp3"></audio>
<audio id="rematchSound" src="rematch.mp3"></audio>

<script>
const boardEl = document.getElementById('board');
const moveSound = document.getElementById('moveSound');
const tickSound = document.getElementById('tickSound');
const winSound = document.getElementById('winSound');
const loseSound = document.getElementById('loseSound');
const rematchSound = document.getElementById('rematchSound');
const popup = document.getElementById('popup');
const popupText = document.getElementById('popup-text');
const acceptBtn = document.getElementById('acceptBtn');
const declineBtn = document.getElementById('declineBtn');

let board=[], selected=null, turn='w', timer=600, timerInterval;
let capturedWhite=[], capturedBlack=[];

// Initialize FIDE standard pieces
const initialBoard=[
  ['r','n','b','q','k','b','n','r'],
  ['p','p','p','p','p','p','p','p'],
  ['','','','','','','',''],
  ['','','','','','','',''],
  ['','','','','','','',''],
  ['','','','','','','',''],
  ['P','P','P','P','P','P','P','P'],
  ['R','N','B','Q','K','B','N','R']
];

// Unicode pieces
const pieces={
  'P':'♙','R':'♖','N':'♘','B':'♗','Q':'♕','K':'♔',
  'p':'♟','r':'♜','n':'♞','b':'♝','q':'♛','k':'♚'
};

function renderBoard(){
  boardEl.innerHTML='';
  for(let r=0;r<8;r++){
    for(let c=0;c<8;c++){
      const sq=document.createElement('div');
      sq.className='square '+((r+c)%2==0?'white':'black');
      sq.dataset.row=r;
      sq.dataset.col=c;
      sq.textContent=pieces[board[r][c]]||'';
      if(selected && selected.row==r && selected.col==c) sq.classList.add('highlight');
      sq.addEventListener('click',()=>selectSquare(r,c));
      boardEl.appendChild(sq);
    }
  }
  renderCaptured();
}

function renderCaptured(){
  document.getElementById('capturedWhite').textContent=capturedWhite.map(p=>pieces[p]).join(' ');
  document.getElementById('capturedBlack').textContent=capturedBlack.map(p=>pieces[p]).join(' ');
}

function selectSquare(r,c){
  if(selected && validMove(selected,r,c)){
    movePiece(selected,r,c);
    selected=null;
    switchTurn();
  } else if(board[r][c] && ((turn=='w' && board[r][c].toUpperCase()==board[r][c]) || (turn=='b' && board[r][c].toLowerCase()==board[r][c]))){
    selected={row:r,col:c};
  } else selected=null;
  renderBoard();
}

function validMove(from,toRow,toCol){
  // Simple legal move checker (expand for full FIDE rules)
  const piece=board[from.row][from.col];
  if(!piece) return false;
  // Prevent moving opponent pieces
  if(turn=='w' && piece==piece.toLowerCase()) return false;
  if(turn=='b' && piece==piece.toUpperCase()) return false;
  // Prevent capture of own pieces
  const target=board[toRow][toCol];
  if(target && ((turn=='w' && target.toUpperCase()==target)||(turn=='b' && target.toLowerCase()==target))) return false;
  return true; // placeholder for real FIDE validation
}

function movePiece(from,toRow,toCol){
  const target=board[toRow][toCol];
  if(target){
    if(target.toUpperCase()==target) capturedWhite.push(target);
    else capturedBlack.push(target);
  }
  board[toRow][toCol]=board[from.row][from.col];
  board[from.row][from.col]='';
  moveSound.play();
  resetTimer();
}

function switchTurn(){
  turn=turn=='w'?'b':'w';
}

function resetTimer(){
  clearInterval(timerInterval);
  timerInterval=setInterval(()=>{
    timer--;
    document.getElementById('timer').textContent=formatTime(timer);
    if(timer<=10) tickSound.play();
    if(timer<=0) endGame(turn=='w'?'b':'w');
  },1000);
}

function formatTime(t){
  const m=Math.floor(t/60).toString().padStart(2,'0');
  const s=(t%60).toString().padStart(2,'0');
  return `${m}:${s}`;
}

function endGame(winner){
  clearInterval(timerInterval);
  if(winner=='w') winSound.play(); else loseSound.play();
  alert('Game over! Winner: '+(winner=='w'?'White':'Black'));
}

document.getElementById('resignBtn').addEventListener('click',()=>{
  endGame(turn=='w'?'b':'w');
});

document.getElementById('drawBtn').addEventListener('click',()=>{
  popupText.textContent='Player offers draw';
  popup.style.display='flex';
  autoPopupCancel();
});

document.getElementById('rematchBtn').addEventListener('click',()=>{
  rematchSound.play();
  location.reload();
});

acceptBtn.addEventListener('click',()=>{popup.style.display='none'; alert('Draw accepted!'); endGame(null);});
declineBtn.addEventListener('click',()=>{popup.style.display='none'; alert('Draw declined');});

function autoPopupCancel(){
  setTimeout(()=>{ if(popup.style.display=='flex'){ popup.style.display='none'; alert('No response. Offer cancelled.'); } },5000);
}

// Initialize
board=JSON.parse(JSON.stringify(initialBoard));
renderBoard();
resetTimer();

// Pi SDK hooks placeholders
function recordMove(move){ /* integrate Pi SDK */ }
function payRematch(){ /* integrate Pi SDK payment */ }

</script>

</body>
</html>
